# Tests for txt2regex

There are two kinds of tests in this directory.

## txt2regex tests

- [cmdline.md](cmdline.md) — txt2regex command line options
- [features.md](features.md) — txt2regex features

The Markdown files are both documentation and test files. Humans can read them, and the [clitest](https://github.com/aureliojargas/clitest) tool can run them as test suites.

> The clitest tool can identify and run all the commands listed in Markdown files, and then it checks if their actual output matches the documented output.

To run those tests (from this repository root):

- `make test` - to run all the tests in your current shell

- `make test-bash` - to run all the tests in all the supported Bash versions (uses the official Docker image for Bash)


## regex tests

- [Dockerfile](Dockerfile) — Custom Docker image with all the supported programs
- [regex-tester.sh](regex-tester.sh) — The tester
- [regex-tester.txt](regex-tester.txt) — The tester output

To make sure the regexes generated by txt2regex are correct, there's a special regex tester that calls the real programs with specially crafted regexes and sample texts, verifying how those programs behave in "real life". This tester runs inside a Docker container

To avoid having to install specific software in the developer machine,
a Docker image is used to isolate all the necessary software and this
script is run inside that image.

To run this script, use `make test-regex`.

----

# Run regex tests for the supported programs, inside a Docker container
test-regex:
	# Test all programs except "vi"
	docker run --rm -v "$$PWD":/code -w /code $(REGEXTESTERIMAGE) \
		tests/regex-tester.sh --skip vi > tests/regex-tester.txt 2>&1

	docker run --rm -v "$$PWD":/code -w /code -t $(REGEXTESTERIMAGE) \
		tests/regex-tester.sh vi | tr -d '\r' >> tests/regex-tester.txt

test-regex-shell:
	docker run --rm -v "$$PWD":/code -w /code -it $(REGEXTESTERIMAGE)

test-regex-build:
	docker build -t $(REGEXTESTERIMAGE) tests/

clean:


----

Txt2regex needs to know regex-related information for each program it
supports. For example: the list of metacharacters, how to escape a
metacharacter to match it literally, availability of POSIX character
classes.

Instead of relying in documentation to get that information, this
script calls the real programs with specially crafted regexes and
sample texts, verifying how those programs behave in "real life".

The version information for each program is also extracted, so we can
have a record of how it behaved in that specific version.

To have a permanent record, the output of this script is also saved to
this repository. This way we can detect changes in behavior when a
program version is updated.

To avoid having to install specific software in the developer machine,
a Docker image is used to isolate all the necessary software and this
script is run inside that image.
